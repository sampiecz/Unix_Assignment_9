This is the nastiest code ever.  Unless you really like nested if statements.
